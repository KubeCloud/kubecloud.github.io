<!doctype html><html lang=en-us><head><meta charset=utf-8><title>kubecloud</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="This blog post will walk you through the steps of setting up kubernetes-on-arm that Luxas has created. Thanks to Luxas’ project it is…"><meta name=author content="kubecloud.io"><meta name=generator content="Hugo 0.62.2"><link rel=stylesheet href=https://kubecloud.io/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://kubecloud.io/plugins/themify-icons/themify-icons.css><link rel=stylesheet href=https://kubecloud.io/scss/style.min.e92287ba30e877e203e37f813150a9226378acce473f0a198f39c3a0294241b4.css integrity="sha256-6SKHujDod+ID43+BMVCpImN4rM5HPwoZjznDoClCQbQ=" media=screen><link rel="shortcut icon" href=https://kubecloud.io/images/favicon.png type=image/x-icon><link rel=icon href=https://kubecloud.io/images/favicon.png type=image/x-icon></head><body><div class=preloader></div><header class=navigation><div class="col-md-10 offset-md-1"><nav class="navbar navbar-expand-lg navbar-white bg-transparent"><a class="navbar-brand mobile-view" href=https://kubecloud.io><img class=img-fluid src=https://kubecloud.io/images/kubecloud.png alt=kubecloud></a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i></button><div class="collapse navbar-collapse text-center" id=navigation><a class="navbar-brand desktop-view" href=https://kubecloud.io><img class=img-fluid src=https://kubecloud.io/images/kubecloud.png alt=kubecloud></a><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://kubecloud.io>Home</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Blog</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=https://kubecloud.io/blog>All</a><div class=dropdown-divider></div><a class=dropdown-item href=https://kubecloud.io/categories/conference>Conference</a>
<a class=dropdown-item href=https://kubecloud.io/categories/kops>Kops</a>
<a class=dropdown-item href=https://kubecloud.io/categories/raspberry-pi>Raspberry pi</a>
<a class=dropdown-item href=https://kubecloud.io/categories/thesis>Thesis</a></div></li><li class=nav-item><a class=nav-link href=https://kubecloud.io/about>About</a></li></ul><div class="search px-4"><button id=searchOpen class=search-btn><i class=ti-search></i></button><div class=search-wrapper><form action=https://kubecloud.io/search class=h-100><input class="search-box px-4" id=search-query name=s type=search placeholder="Type & Hit Enter..."></form><button id=searchClose class=search-close><i class="ti-close text-dark"></i></button></div></div></div></nav></div></header><section class=section-sm><div class=container><div class=row><div class="col-lg-10 mx-auto"><a href=https://kubecloud.io/categories/thesis class=text-primary>Thesis</a><h1>[Guide] Setting up a Kubernetes on ARM cluster on Raspberry Pis</h1><div class="mb-3 post-meta"><span>By Kasper Nissen,</span>
<span>13 April 2016</span></div><div class="content mb-5"><p>This blog post will walk you through the steps of setting up kubernetes-on-arm that <a href=https://github.com/luxas/>Luxas</a> has created. Thanks to <a href=https://github.com/luxas/kubernetes-on-arm>Luxas’ project</a> it is pretty straightforward to get Kubernetes up and running on a Raspberry Pi. This guide will walk you through a fork of Luxas’ project, that contains minor adjustments to the <a href=https://github.com/rpicloud/kubernetes-on-arm/commit/d7635f8e6e45f9657f53f71b5f0b54403da0c7af>DNS</a> and a couple of <a href=https://github.com/rpicloud/kubernetes-on-arm/commit/51d5edaa548f70680e43cdaa7f0a79d9edb371a6>extra scripts</a>.</p><h4 id=overall-setup>Overall setup</h4><p>The goal of this guide to get a cluster of four nodes up and running. One master and three workers. In this guide ArchLinux will be installed on all of the nodes and static IPs assigned. We have tried ArchLinux out and found it most stable in our setup. Afterwards Kubernetes-on-arm will be installed, and each node configured as either a master or a worker. Let’s get started!</p><p><img src=https://kubecloud.io/images/0__319jSZ4qdgJgHaW4.jpg alt></p><h4 id=sd-cards>SD cards</h4><p>First the SD cards must be flashed. Since we are using OSX, we used the build-in Disk Utility to erase each SD card with the format “MS-DOS (FAT)” and Scheme “GUID Partition Map”. Remember to unmount each card before you unplug it.</p><p><img src=https://kubecloud.io/images/0__VylGV3YROrxRl__FT.png alt></p><p>Afterwards we continued on a Linux machine inserting one SD card at a time.</p><pre><code>sudo fdisk -l
</code></pre><p><img src=https://kubecloud.io/images/0__S8Vq0N3NiOwm61tg.png alt></p><p>As seen above the SD card is found as /dev/sdb, your device might get a different name. To be able to write to the SD card /dev/sdb2 is unmounted. Afterwards pull kubernetes-on-arm and start writing with the arguments for the Raspberry Pi 2, ArchLinux and kubesystemd. There are more options on Luxas’ kubernetes-on-arm.</p><pre><code>$ sudo umount /dev/sdb2 $ git pull https://github.com/rpicloud/kubernetes-on-arm.git $ cd kubernetes-on-arm $ sudo sdcard/write.sh /dev/sdb rpi-2 archlinux kube-systemd
</code></pre><p>You will be prompted that you will loose all data on the device, so make sure that you select the right device from the fdisk step.</p><p>The write script will download and copy the files to your SD card, and in the end you should see an output similar to the one below.</p><p><img src=https://kubecloud.io/images/0__1gqy2EiUdWpRXCE1.png alt></p><p>Repeat this step for each SD card and you should be ready for the next step.</p><h4 id=static-ip>Static IP</h4><p>In order to know where the different nodes are both for yourself and Kubernetes, static IPs can be a help. Since we have eight clusters and a router with gateway IP <code>192.168.1.1</code>, we use a convention that concatenates (notice || syntax later) the cluster number with the node number in the last section of the IP: <code>192.168.1.(cluster || node)</code>. Cluster 1 node 1 will get the IP: <code>192.168.1.11</code>, while node 2 in the same cluster will get: 192.168.1.12.</p><p>Now, how do we connect a Raspberry Pi? You can either plug in an HDMI-cable and a keyboard or use SSH. We plugged in one Raspberry Pi at a time, found the newly assigned IP under ‘logs’ section and changed it one at a time.</p><p>An example could be that your router assigned the first Raspberry Pi the IP <code>192.168.1.189</code> you can log in and change your IP in the following way.</p><pre><code>$ ssh root@192.168.1.189 # You will be asked if you trust the key fingerprint - type 'yes' # Afterwards type the password 'root' # Edit the following file e.g. with nano $ nano /etc/systemd/network/dns.network
</code></pre><p>When you have opened the file, delete everything and paste in the lines below. Notice that <code>192.168.1.11</code> is the static IP address here. The DNS entry sets up <code>10.0.0.10</code> which is default for kube-dns, the local <code>192.168.1.1</code> gateway and Google's DNS.</p><pre><code>[Match] Name=eth0 [Network] Address=192.168.1.11/24 Gateway=192.168.1.1 Domains=default.svc.cluster.local svc.cluster.local cluster.local DNS=10.0.0.10 192.168.1.1 8.8.8.8
</code></pre><p>Hit ctrl+x and then ‘y’ to save the file and reboot to make the change go through.</p><pre><code>reboot
</code></pre><p>Now connect as earlier with the new IP.</p><pre><code>$ ssh root@192.168.1.11
</code></pre><h4 id=installing-kubernetes-anddocker>Installing Kubernetes (and Docker)</h4><p>From Luxas’ image comes a command line tool called <code>kube-config</code> that can control much of the configuration around Kubernetes. To install Docker and Kubernetes run:</p><pre><code>kube-config install
</code></pre><p>It will take some time to download everything, and in the end you will be prompted for a name. We have used the same naming convention as the last section of the IP, giving cluster 1’s node 1 the name node11. <br> Afterwards you will be asked for timezone, swapfile and if you want to reboot. The default values seems fine, so just press enter.</p><p>Since one of your nodes must be a master, you have to branch out differently from here.</p><p>Master</p><p>On the master simply run the command:</p><pre><code>kube-config enable-master
</code></pre><p>From the command has finished until Kubernetes is up can take some minutes. You can follow the creation of Docker containers by running <code>docker ps</code> and, at some point, <code>kubectl get nodes</code>. Get nodes will show the nodes connected to this master (including the master itself).</p><p>Slave</p><p>For each slave (e.g. ending IP with 12, 13, 14) you need to wait for the master to be ready and then specify the ip of the master in the following way.</p><pre><code>kube-config enable-worker 192.168.1.11
</code></pre><p>When all of the nodes have downloaded and started a worker, check from the master that the workers are connected to it by running <code>kubectl get nodes</code>.</p><h4 id=startup-andshutdown>Startup and shutdown</h4><p>The extra scripts, mentioned in the introduction, can help you start up and shut down your cluster from the master node without bringing the nodes in an inconsistent state. <br> In order, for the master, to be able to run commands on the workers you need to set up ssh-keys and copy them to the workers. You can do so in the following way (e.g. from node11):</p><pre><code>ssh-keygen # Hit enter about three times ssh-copy-id root@192.168.1.12 ssh-copy-id root@192.168.1.13 ssh-copy-id root@192.168.1.14
</code></pre><p>The scripts are placed in the /root/ folder, and you run them from the master node in the following way.</p><pre><code>sh startup.sh sh shutdown.sh
</code></pre><p>Now you should be ready to play with Kubernetes on your Raspberry Pi cluster. Have fun with it!</p><p><em>Originally published at</em> <a href=http://kubecloud.io/kubernetes-on-arm-cluster/><em>kubecloud.io</em></a> <em>on April 13, 2016.</em></p></div></div></div></div></section><footer><div class="col-md-10 offset-md-1"><div class=row><div class="col-lg-3 col-sm-6 mb-5"><a href=https://kubecloud.io><img class=img-fluid src=https://kubecloud.io/images/kubecloud.png alt=kubecloud></a></div><div class="col-lg-3 col-sm-6 mb-5"></div><div class="col-lg-3 col-sm-6 mb-5"></div><div class="col-lg-3 col-sm-6 mb-5 text-right"><h6 class=mb-4>Quick Links</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=https://kubecloud.io/blog>Blog</a></li><li class=mb-3><a class=text-dark href=https://kubecloud.io/about/about>About</a></li></ul></div><div class="col-6 py-4 text-left social border-top"><ul><li><a class=social-link href=https://twitter.com/phennex><i class=ti-twitter-alt></i></a></li><li><a class=social-link href=https://twitter.com/mrjensens><i class=ti-twitter-alt></i></a></li><li><a class=social-link href=https://github.com/kubecloud><i class=ti-github></i></a></li></ul></div><div class="col-6 py-4 text-right border-top">@2020 <a href=https://kubecloud.io>kubecloid.io</a> All Rights Reserved</div></div></div></footer><script>var indexURL="https://kubecloud.io/index.json"</script><script src=https://kubecloud.io/plugins/jQuery/jquery.min.js></script><script src=https://kubecloud.io/plugins/bootstrap/bootstrap.min.js></script><script src=https://kubecloud.io/plugins/search/fuse.min.js></script><script src=https://kubecloud.io/plugins/search/mark.js></script><script src=https://kubecloud.io/plugins/search/search.js></script><script src=https://kubecloud.io/js/script.min.js></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','Your ID','auto');ga('send','pageview');</script></body></html>